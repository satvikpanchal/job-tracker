{% extends "layout.html" %}

{% block content %}
<!-- Classifier Status -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">
            <i class="fas fa-robot"></i>
            AI Classifier Status
        </h2>
    </div>
    <div class="card-body">
        <div class="classifier-info">
            <div class="classifier-status" id="classifierStatus">
                <span class="status-indicator">Loading...</span>
                <span class="classifier-type" id="classifierType">Unknown</span>
            </div>
            <div class="classifier-controls">
                <button class="btn btn-outline btn-sm" onclick="checkClassifierStatus()">
                    <i class="fas fa-sync"></i>
                    Check Status
                </button>
                <button class="btn btn-outline btn-sm" onclick="switchClassifier()">
                    <i class="fas fa-exchange-alt"></i>
                    Switch Classifier
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Add New Job -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">
            <i class="fas fa-plus"></i>
            Add New Job Application
        </h2>
    </div>
    <div class="card-body">
        <form action="/add" method="post" class="add-job-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="company">Company Name</label>
                    <input type="text" id="company" name="company" placeholder="e.g. Google, Microsoft, Apple" required>
                </div>
                <div class="form-group">
                    <label for="role">Job Role</label>
                    <input type="text" id="role" name="role" placeholder="e.g. Software Engineer, Product Manager" required>
                </div>
                <div class="form-group form-group-button">
                    <label>&nbsp;</label>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Add Job
                    </button>
                </div>
            </div>
            <details class="form-details">
                <summary>Additional Options</summary>
                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" name="notes" placeholder="Any additional information about this application..."></textarea>
                </div>
            </details>
        </form>
    </div>
</section>

<!-- Job Applications -->  
<section class="card">
    <div class="card-header">
        <div class="card-title-row">
            <h2 class="card-title">
                <i class="fas fa-briefcase"></i>
                Job Applications
            </h2>
            <div class="table-controls">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search companies or roles...">
                </div>
                <div class="filter-dropdown">
                    <button class="btn btn-outline" id="filterBtn">
                        <i class="fas fa-filter"></i>
                        Filter
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="filterMenu">
                        <label class="dropdown-item">
                            <input type="checkbox" value="all" checked> All Status
                        </label>
                        <label class="dropdown-item">
                            <input type="checkbox" value="applied"> Applied
                        </label>
                        <label class="dropdown-item">
                            <input type="checkbox" value="interview"> Interview
                        </label>
                        <label class="dropdown-item">
                            <input type="checkbox" value="offer"> Offer
                        </label>
                        <label class="dropdown-item">
                            <input type="checkbox" value="rejected"> Rejected
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card-body">
        {% if jobs %}
        <div class="table-container">
            <table class="jobs-table" id="jobsTable">
                <thead>
                    <tr>
                        <th class="px-4 py-2">
                            <input type="checkbox" id="selectAll" aria-label="Select all jobs">
                        </th>
                        <th class="px-4 py-2">Company</th>
                        <th class="px-4 py-2">Role</th>
                        <th class="px-4 py-2">Status</th>
                        <th class="px-4 py-2">Applied On</th>
                        <th class="px-4 py-2">Last Update</th>
                        <th class="px-4 py-2">Notes</th>
                        <th class="text-center px-4 py-2 rounded-tr-2xl min-w-[110px]">Actions</th>
                    </tr>
                </thead>
                <tbody id="jobsTableBody">
                    {% for job in jobs %}
                    <tr data-job-id="{{ job.id }}" data-status="{{ job.status }}">
                        <td class="px-4 py-2">
                            <input type="checkbox" class="job-checkbox" value="{{ job.id }}">
                        </td>
                        <td class="company-cell px-4 py-2">
                            <div class="company-name">{{ job.company }}</div>
                        </td>
                        <td class="role-cell px-4 py-2">{{ job.role }}</td>
                        <td class="status-cell px-4 py-2">
                            <span class="status-badge status-{{ job.status }}">
                                {% if job.status == 'applied' %}
                                    <i class="fas fa-paper-plane"></i> Applied
                                {% elif job.status == 'interview' %}
                                    <i class="fas fa-calendar-alt"></i> Interview
                                {% elif job.status == 'offer' %}
                                    <i class="fas fa-trophy"></i> Offer
                                {% elif job.status == 'rejected' %}
                                    <i class="fas fa-times-circle"></i> Rejected
                                {% endif %}
                            </span>
                        </td>
                        <td class="date-cell px-4 py-2">{{ job.applied_date_formatted or 'N/A' }}</td>
                        <td class="date-cell px-4 py-2">{{ job.last_update_formatted or 'N/A' }}</td>
                        <td class="notes-cell px-4 py-2" data-company="{{ job.company }}" data-role="{{ job.role }}" data-note="{{ job.note or '' }}">
                            {% if job.note %}
                                <span class="note-text">{{ job.note[:20] }}{% if job.note|length > 20 %}...{% endif %}</span>
                            {% else %}
                                â€”
                            {% endif %}
                        </td>
                        <td class="actions-cell text-center px-4 py-2 min-w-[110px]">
                            <button class="btn btn-ghost btn-sm update-btn" data-job-id="{{ job.id }}" data-company="{{ job.company }}" data-role="{{ job.role }}" data-status="{{ job.status }}" aria-label="Update {{ job.company }}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-ghost btn-sm btn-danger delete-btn" data-job-id="{{ job.id }}" data-company="{{ job.company }}" aria-label="Delete {{ job.company }}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>        
        
        <!-- Bulk Actions -->
        <div class="bulk-actions" id="bulkActions" style="display: none;">
            <div class="bulk-actions-content">
                <span class="selected-count" id="selectedCount">0 selected</span>
                <div class="bulk-buttons">
                    <button class="btn btn-outline btn-sm" id="bulkUpdateBtn">
                        <i class="fas fa-edit"></i> Update Status
                    </button>
                    <button class="btn btn-outline btn-sm btn-danger" id="bulkDeleteBtn">
                        <i class="fas fa-trash"></i> Delete Selected
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Pagination -->
        <div class="pagination-container">
            <div class="pagination-info">
                <span id="paginationInfo">Showing 1-10 of 10 jobs</span>
            </div>
            <div class="pagination-controls">
                <div class="page-size-selector">
                    <label for="pageSize">Show:</label>
                    <select id="pageSize">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                    </select>
                    <span>jobs per page</span>
                </div>
                <div class="pagination-buttons">
                    <button class="btn btn-ghost btn-sm" id="prevPage" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="page-numbers" id="pageNumbers">1</span>
                    <button class="btn btn-ghost btn-sm" id="nextPage" disabled>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
        
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-briefcase"></i>
            </div>
            <h3>No job applications yet</h3>
            <p>Start by adding your first job application above</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- Mobile Card View -->
<div class="mobile-cards" id="mobileCards" style="display: none;">
    {% for job in jobs %}
    <div class="job-card" data-job-id="{{ job.id }}" data-status="{{ job.status }}">
        <div class="job-card-header">
            <h3>{{ job.company }}</h3>
            <span class="status-badge status-{{ job.status }}">
                {% if job.status == 'applied' %}
                    <i class="fas fa-paper-plane"></i> Applied
                {% elif job.status == 'interview' %}
                    <i class="fas fa-calendar-alt"></i> Interview
                {% elif job.status == 'offer' %}
                    <i class="fas fa-trophy"></i> Offer
                {% elif job.status == 'rejected' %}
                    <i class="fas fa-times-circle"></i> Rejected
                {% endif %}
            </span>
        </div>
        <div class="job-card-body">
            <p class="job-role">{{ job.role }}</p>
            <div class="job-dates">
                <span>Applied: {{ job.applied_date_formatted or 'N/A' }}</span>
                <span>Updated: {{ job.last_update_formatted or 'N/A' }}</span>
            </div>
        </div>
        <div class="job-card-actions">
            <button class="btn btn-outline btn-sm update-btn" data-job-id="{{ job.id }}" data-company="{{ job.company }}" data-role="{{ job.role }}" data-status="{{ job.status }}">
                <i class="fas fa-edit"></i> Update
            </button>
            <button class="btn btn-outline btn-sm btn-danger delete-btn" data-job-id="{{ job.id }}" data-company="{{ job.company }}">
                <i class="fas fa-trash"></i> Delete
            </button>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Notes Modal -->
<div class="notes-modal" id="notesModal">
    <div class="notes-modal-content">
        <div class="notes-modal-header">
            <h3 class="notes-modal-title">
                <i class="fas fa-sticky-note"></i>
                Job Notes
            </h3>
            <button class="btn btn-ghost notes-modal-close" onclick="closeNotesModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notes-modal-body">
            <div class="notes-modal-company" id="notesModalCompany"></div>
            <div class="notes-modal-role" id="notesModalRole"></div>
            <div class="notes-modal-note" id="notesModalNote"></div>
        </div>
    </div>
</div>

<!-- Classifier Selection Modal -->
<div id="classifierModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-robot"></i> Select Classifier</h2>
            <span class="close" onclick="closeClassifierModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="classifier-options">
                <div class="classifier-option" data-type="slm">
                    <div class="classifier-header">
                        <i class="fas fa-server"></i>
                        <h3>Local Small Language Model (SLM)</h3>
                        <span class="status-badge status-success" id="slmStatus">Available</span>
                    </div>
                    <div class="classifier-details">
                        <p><strong>Model:</strong> 
                            <select id="slmModelSelect" class="model-select">
                                <option value="">Loading models...</option>
                            </select>
                            <span class="current-model" id="currentModelDisplay"></span>
                        </p>
                        <p><strong>Base URL:</strong> <span id="slmUrl">http://localhost:11434</span></p>
                        <p><strong>Available Models:</strong> <span id="slmModels">Loading...</span></p>
                        <p class="description">Fast, local inference with no API costs. Runs on your machine.</p>
                    </div>
                </div>
                
                <div class="classifier-option" data-type="gemini">
                    <div class="classifier-header">
                        <i class="fas fa-cloud"></i>
                        <h3>Google Gemini</h3>
                        <span class="status-badge status-info" id="geminiStatus">Available</span>
                    </div>
                    <div class="classifier-details">
                        <p><strong>API Key:</strong> <span id="geminiKey">Configured</span></p>
                        <p><strong>Model:</strong> Gemini Pro</p>
                        <p class="description">High-quality cloud-based AI with excellent accuracy.</p>
                    </div>
                </div>
            </div>
            
            <div class="classifier-actions">
                <button class="btn btn-primary" onclick="applyClassifierSelection()">
                    <i class="fas fa-check"></i>
                    Apply Selection
                </button>
                <button class="btn btn-outline" onclick="closeClassifierModal()">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}
